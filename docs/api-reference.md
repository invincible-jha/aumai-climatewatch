# API Reference — aumai-climatewatch

Complete reference for all public classes, functions, and Pydantic models in the
`aumai_climatewatch` package. All classes and functions are typed; the package requires
Python 3.11+ and uses strict mypy mode.

---

## Module: `aumai_climatewatch.models`

Pydantic v2 models used as input and output at all API boundaries.

---

### `ENVIRONMENTAL_DISCLAIMER`

```python
ENVIRONMENTAL_DISCLAIMER: str
```

Mandatory disclaimer string included in all CLI output:

> *"Climate and weather data provided by this tool are estimates based on historical averages
> and modelled projections. Do not use this tool as the sole basis for emergency response
> decisions. Always verify alerts with official meteorological authorities such as IMD
> (India Meteorological Department) before taking action."*

---

### `ClimateZone`

```python
class ClimateZone(BaseModel):
    zone_id: str
    name: str
    states: list[str]
    avg_rainfall_mm: float
    avg_temp_c: float
```

One of India's major climate zones, aligned with the IMD meteorological subdivision framework.

**Fields:**

| Field             | Type        | Constraints | Description |
|-------------------|-------------|-------------|-------------|
| `zone_id`         | `str`       | required    | Unique zone identifier slug (e.g., `"central-india"`) |
| `name`            | `str`       | required    | Human-readable zone name (e.g., `"Central India"`) |
| `states`          | `list[str]` | required    | States falling within this zone |
| `avg_rainfall_mm` | `float`     | `>= 0.0`    | Average annual rainfall in millimetres |
| `avg_temp_c`      | `float`     | required    | Average annual temperature in Celsius |

**Available zones:**

| zone_id              | Name                 | States (count) | Avg Rain (mm) | Avg Temp (°C) |
|----------------------|----------------------|----------------|---------------|---------------|
| `northwest-india`    | Northwest India      | 6              | 350           | 24.0          |
| `northeast-india`    | Northeast India      | 8              | 2500          | 22.0          |
| `central-india`      | Central India        | 4              | 1100          | 27.0          |
| `western-india`      | Western India        | 3              | 900           | 27.5          |
| `southern-peninsula` | Southern Peninsula   | 5              | 1200          | 28.0          |
| `eastern-india`      | Eastern India        | 4              | 1050          | 26.5          |

**Example:**

```python
from aumai_climatewatch.core import ClimateZoneRegistry

registry = ClimateZoneRegistry()
zone = registry.get_zone("central-india")
print(zone.states)      # ['Madhya Pradesh', 'Chhattisgarh', 'Jharkhand', 'Odisha']
print(zone.avg_rainfall_mm)  # 1100.0
```

---

### `WeatherAlert`

```python
class WeatherAlert(BaseModel):
    alert_id: str
    alert_type: str
    severity: str
    affected_zones: list[str]
    message: str
    issued_at: datetime
    valid_until: datetime
```

An early-warning alert for an extreme weather or climate event. Generated by
`AlertGenerator.evaluate_conditions()`.

**Fields:**

| Field            | Type            | Constraints | Description |
|------------------|-----------------|-------------|-------------|
| `alert_id`       | `str`           | required    | Unique alert identifier (UUID4 string) |
| `alert_type`     | `str`           | must be one of the values below | Category of weather event |
| `severity`       | `str`           | must be one of the values below | Alert severity level |
| `affected_zones` | `list[str]`     | required    | Zone IDs affected by this alert |
| `message`        | `str`           | required    | Human-readable alert message for end-user display |
| `issued_at`      | `datetime`      | required    | UTC-aware timestamp when alert was issued |
| `valid_until`    | `datetime`      | required    | UTC-aware timestamp when alert expires |

**Valid `alert_type` values:**

| Value         | Trigger condition |
|---------------|------------------|
| `flood`       | Rainfall >= 200 mm/24h |
| `drought`     | Rainfall deficit >= 25% below normal |
| `heatwave`    | Temperature >= 40°C |
| `cold_wave`   | Temperature <= 5°C |
| `cyclone`     | Wind speed >= 64 km/h |
| `thunderstorm`| (Reserved for future use) |

**Valid `severity` values:**

| Value            | Meaning |
|------------------|---------|
| `watch`          | Conditions developing; monitor situation |
| `warning`        | Hazardous conditions expected or occurring |
| `severe_warning` | Extreme hazard; immediate protective action required |

**Alert validity periods:**

- Flood, heatwave, cold wave, cyclone: `valid_until = issued_at + 24 hours`
- Drought: `valid_until = issued_at + 7 days`

**Example:**

```python
print(alert.alert_id)
print(f"[{alert.severity}] {alert.alert_type}: {alert.message}")
print(f"Valid until: {alert.valid_until.isoformat()}")
```

---

### `ClimateReport`

```python
class ClimateReport(BaseModel):
    zone: ClimateZone
    current_conditions: dict[str, object]
    alerts: list[WeatherAlert] = []
    forecast: dict[str, object] = {}
```

Comprehensive climate report for a zone at a point in time. Generated by
`ClimateAnalyzer.generate_report()`.

**Fields:**

| Field                | Type                    | Description |
|----------------------|-------------------------|-------------|
| `zone`               | `ClimateZone`           | The climate zone this report covers |
| `current_conditions` | `dict[str, object]`     | Raw weather measurement dict passed to `generate_report()` |
| `alerts`             | `list[WeatherAlert]`    | Active weather alerts for this zone; may be empty |
| `forecast`           | `dict[str, object]`     | Short-range forecast summary (see structure below) |

**Forecast structure:**

The `forecast` dict contains two keys:

```python
{
    "next_24h": {
        "temperature_c": float,          # current temperature
        "expected_rainfall_mm": float,   # current rainfall * 0.8 (persistence heuristic)
        "humidity_pct": float,           # current humidity
        "advisory": str,                 # static advisory text
    },
    "next_7_days": {
        "trend": str,          # "wetter than normal" | "drier than normal" | "near normal"
        "temperature_trend": str,  # "above normal" | "below normal" | "near normal"
    },
}
```

**Serialisation example:**

```python
import json
report_json = json.dumps(report.model_dump(), indent=2, default=str)
```

---

## Module: `aumai_climatewatch.core`

The core engine. Contains three classes: `ClimateZoneRegistry`, `AlertGenerator`, and
`ClimateAnalyzer`.

---

### `ClimateZoneRegistry`

```python
class ClimateZoneRegistry:
    def __init__(self) -> None: ...
    def all_zones(self) -> list[ClimateZone]: ...
    def get_zone(self, zone_id: str) -> ClimateZone | None: ...
    def zones_for_state(self, state: str) -> list[ClimateZone]: ...
```

Registry of India's six major IMD climate zones. Thread-safe for concurrent reads after
construction.

---

#### `ClimateZoneRegistry.__init__`

```python
def __init__(self) -> None
```

Builds the zone registry from the static `_ZONES` dataset at import time.

---

#### `ClimateZoneRegistry.all_zones`

```python
def all_zones(self) -> list[ClimateZone]
```

Return all registered climate zones.

**Returns:** `list[ClimateZone]` — all six zones in dict-value order.

**Example:**

```python
from aumai_climatewatch.core import ClimateZoneRegistry

registry = ClimateZoneRegistry()
for zone in registry.all_zones():
    print(f"{zone.zone_id}: {zone.name}")
```

---

#### `ClimateZoneRegistry.get_zone`

```python
def get_zone(self, zone_id: str) -> ClimateZone | None
```

Look up a zone by its string ID.

**Parameters:**

| Parameter | Type  | Description |
|-----------|-------|-------------|
| `zone_id` | `str` | The zone identifier slug (e.g., `"central-india"`) |

**Returns:** `ClimateZone` if found, `None` if the `zone_id` does not exist.

**Example:**

```python
zone = registry.get_zone("central-india")
if zone is None:
    raise ValueError("Zone not found")
```

---

#### `ClimateZoneRegistry.zones_for_state`

```python
def zones_for_state(self, state: str) -> list[ClimateZone]
```

Return all zones that include a given state. Comparison is case-insensitive exact match.

**Parameters:**

| Parameter | Type  | Description |
|-----------|-------|-------------|
| `state`   | `str` | State name, e.g., `"Maharashtra"`, `"West Bengal"` |

**Returns:** `list[ClimateZone]` — zones containing this state; typically one zone per state.

**Example:**

```python
zones = registry.zones_for_state("Kerala")
print(f"Kerala is in: {zones[0].name}")
```

---

### `AlertGenerator`

```python
class AlertGenerator:
    def evaluate_conditions(
        self, zone: ClimateZone, data: dict[str, object]
    ) -> list[WeatherAlert]: ...
```

Generates weather alerts from raw climate observations using rule-based threshold logic.
Aligned with IMD operational alert thresholds.

**Alert thresholds:**

| Alert type    | Severity         | Threshold |
|---------------|------------------|-----------|
| flood         | warning          | rainfall_mm >= 200.0 |
| flood         | severe_warning   | rainfall_mm >= 400.0 |
| drought       | watch            | rainfall_deficit_pct >= 25.0 |
| drought       | severe_warning   | rainfall_deficit_pct >= 50.0 |
| heatwave      | warning          | temperature_c >= 40.0 |
| heatwave      | severe_warning   | temperature_c >= 45.0 |
| cold_wave     | warning          | temperature_c <= 5.0 |
| cyclone       | warning (watch)  | wind_kmh >= 64.0 |
| cyclone       | severe_warning   | wind_kmh >= 118.0 |

---

#### `AlertGenerator.evaluate_conditions`

```python
def evaluate_conditions(
    self, zone: ClimateZone, data: dict[str, object]
) -> list[WeatherAlert]
```

Apply threshold rules to the observation data and return a list of active alerts. Multiple
alert types may be returned simultaneously if multiple thresholds are exceeded.

**Parameters:**

| Parameter | Type                  | Description |
|-----------|-----------------------|-------------|
| `zone`    | `ClimateZone`         | The climate zone to evaluate alerts for |
| `data`    | `dict[str, object]`   | Weather observations. Recognised keys: `temperature_c`, `rainfall_mm`, `wind_kmh`, `rainfall_deficit_pct`. Missing keys default to `0.0` or zone average. |

**Returns:** `list[WeatherAlert]` — active alerts in order: flood, drought, heatwave,
cold wave, cyclone. Empty list if no thresholds are exceeded.

**Each alert contains:**
- `alert_id`: UUID4 string (unique per invocation)
- `alert_type`: event category string
- `severity`: `"watch"`, `"warning"`, or `"severe_warning"`
- `affected_zones`: `[zone.zone_id]`
- `message`: human-readable alert text
- `issued_at`: UTC now at time of call
- `valid_until`: 24h after `issued_at` for acute events; 7 days for drought

**Example:**

```python
from aumai_climatewatch.core import ClimateZoneRegistry, AlertGenerator

registry = ClimateZoneRegistry()
generator = AlertGenerator()

zone = registry.get_zone("northwest-india")
data = {
    "temperature_c": 47.0,
    "rainfall_mm": 1.0,
    "wind_kmh": 20.0,
    "rainfall_deficit_pct": 55.0,
}

alerts = generator.evaluate_conditions(zone, data)
for alert in alerts:
    print(f"[{alert.severity}] {alert.alert_type}: {alert.message[:60]}...")
```

---

### `ClimateAnalyzer`

```python
class ClimateAnalyzer:
    def __init__(self) -> None: ...
    def generate_report(
        self, zone: ClimateZone, weather_data: dict[str, object]
    ) -> ClimateReport: ...
    def trend_analysis(
        self, zone: ClimateZone, historical: list[dict[str, object]]
    ) -> dict[str, object]: ...
```

Generates comprehensive climate reports and trend analyses. Internally holds an
`AlertGenerator` instance.

---

#### `ClimateAnalyzer.__init__`

```python
def __init__(self) -> None
```

Initialises the analyzer and its internal `AlertGenerator`.

---

#### `ClimateAnalyzer.generate_report`

```python
def generate_report(
    self, zone: ClimateZone, weather_data: dict[str, object]
) -> ClimateReport
```

Generate a `ClimateReport` for the zone given current weather observations.

**Parameters:**

| Parameter      | Type                  | Description |
|----------------|-----------------------|-------------|
| `zone`         | `ClimateZone`         | The climate zone to report on |
| `weather_data` | `dict[str, object]`   | Current weather observations. Recognised keys: `temperature_c`, `rainfall_mm`, `humidity_pct`. Unrecognised keys are stored in `ClimateReport.current_conditions` but not evaluated. |

**Returns:** `ClimateReport` with:
- `zone`: the input `ClimateZone`
- `current_conditions`: a copy of `weather_data`
- `alerts`: list from `AlertGenerator.evaluate_conditions()`
- `forecast`: dict with `next_24h` and `next_7_days` summaries

**Forecast logic:**

- `next_24h.expected_rainfall_mm = rainfall_mm * 0.8` (persistence dampening)
- `next_7_days.trend`: `"wetter than normal"` if `rainfall_mm > avg_rainfall_mm / 30`,
  `"drier than normal"` if `rainfall_mm < avg_rainfall_mm / 60`, else `"near normal"`
- `next_7_days.temperature_trend`: `"above normal"` if `temp > avg_temp_c + 3`,
  `"below normal"` if `temp < avg_temp_c - 3`, else `"near normal"`

**Example:**

```python
from aumai_climatewatch.core import ClimateZoneRegistry, ClimateAnalyzer

registry = ClimateZoneRegistry()
analyzer = ClimateAnalyzer()

zone = registry.get_zone("western-india")
report = analyzer.generate_report(zone, {
    "temperature_c": 42.0,
    "rainfall_mm": 0.0,
    "humidity_pct": 20.0,
    "wind_kmh": 25.0,
    "rainfall_deficit_pct": 45.0,
})
print(f"Alerts: {len(report.alerts)}")
print(f"Trend: {report.forecast['next_7_days']}")
```

---

#### `ClimateAnalyzer.trend_analysis`

```python
def trend_analysis(
    self, zone: ClimateZone, historical: list[dict[str, object]]
) -> dict[str, object]
```

Compute basic trend statistics from a list of historical weather observations.

**Parameters:**

| Parameter    | Type                       | Description |
|--------------|----------------------------|-------------|
| `zone`       | `ClimateZone`              | The zone for anomaly comparisons |
| `historical` | `list[dict[str, object]]`  | List of observation dicts. Each dict may contain `"temperature_c"` and/or `"rainfall_mm"` keys. |

**Returns:** `dict[str, object]` with the following structure:

```python
{
    "zone_id": str,
    "zone_name": str,
    "observations": int,
    "temperature": {         # only present if any temperature_c values found
        "mean_c": float,
        "min_c": float,
        "max_c": float,
        "anomaly_vs_normal_c": float,   # mean_c - zone.avg_temp_c
    },
    "rainfall": {            # only present if any rainfall_mm values found
        "total_mm": float,
        "mean_daily_mm": float,
        "deficit_vs_normal_pct": float, # (1 - total/expected) * 100
    },
}
```

If `historical` is empty, returns `{"error": "No historical data provided."}`.

**Example:**

```python
historical = [
    {"temperature_c": 30.0, "rainfall_mm": 5.0},
    {"temperature_c": 34.0, "rainfall_mm": 0.0},
    {"temperature_c": 32.0, "rainfall_mm": 15.0},
]
trend = analyzer.trend_analysis(zone, historical)
print(trend["temperature"]["anomaly_vs_normal_c"])
print(trend["rainfall"]["deficit_vs_normal_pct"])
```

---

## Module: `aumai_climatewatch.cli`

CLI entry point registered as the `climatewatch` console script.

### `main`

The Click group. Invoke with `climatewatch --help`.

### `alerts(zone, data_file)`

Click command. Looks up the zone via `ClimateZoneRegistry.get_zone()`, loads observations
from a JSON file (or uses synthetic defaults), calls `AlertGenerator.evaluate_conditions()`,
and prints formatted alerts to stdout.

### `report(zone, data_file)`

Click command. Generates a full `ClimateReport` via `ClimateAnalyzer.generate_report()` and
prints current conditions, alerts, and forecast to stdout.

### `zones()`

Click command. Lists all zones from `ClimateZoneRegistry.all_zones()` in tabular format.

### `serve(port, host)`

Click command. Not implemented in v0.1.0. Exits with error.

---

## Module: `aumai_climatewatch`

### `__version__`

```python
__version__: str  # "0.1.0"
```

Package version string. Access via `aumai_climatewatch.__version__` or `climatewatch --version`.
